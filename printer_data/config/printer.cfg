[include mainsail.cfg]
[exclude_object]
[include EBB36Can.cfg]
[include KAMP_Settings.cfg]
[include macros.cfg]
[include neopixel.cfg]

[temperature_sensor BTT_CB1]
sensor_type: temperature_host
min_temp: 10
max_temp: 100 

[temperature_sensor SKR_Pico]
sensor_type: temperature_mcu
sensor_mcu: mcu
min_temp: 0
max_temp: 100

[temperature_sensor ebb36]
sensor_type: temperature_mcu
sensor_mcu: EBBCan
min_temp: 0
max_temp: 100

[scanner]
canbus_uuid: 2a0496212cbc
#    adjust to suit your scanner, if using usb change to serial.
#    serial: /dev/serial/by-id/usb-cartographer_cartographer_
x_offset: 0                          
#    adjust for your cartographers offset from nozzle to middle of coil
y_offset: 15                         
#    adjust for your cartographers offset from nozzle to middle of coil
backlash_comp: 0.06531
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
# 
#   Offsets are measured from the centre of your coil, to the tip of your nozzle 
#   on a level axis. It is vital that this is accurate. 
calibration_method: scan
#    leave this as touch unless you want to use scan only for everything. 
sensor: cartographer
#    this must be set as cartographer unless using IDM etc.
sensor_alt: carto
#    alternate name to call commands. CARTO_TOUCH etc
#scanner_touch_z_offset: 0.05         
#    This is the default and will be overwritten and added to the DO NOT SAVE area by using UI to save z offset
mesh_runs: 2
#    Number of passes to make during mesh scan.

[bed_mesh]
zero_reference_position: 115, 110    
#    set this to the middle of your bed
speed: 200
#    movement speed of toolhead during bed mesh
horizontal_move_z: 5
#    height of scanner during bed mesh scan
mesh_min: 35, 6
#    start point of bed mesh [X, Y]
mesh_max: 200, 175
#    end point of bed mesh [X, Y]
probe_count: 30, 30
algorithm: bicubic


[stepper_x]
step_pin: gpio11
dir_pin: !gpio10
enable_pin: !gpio12
microsteps: 16
rotation_distance: 40
endstop_pin: ^gpio4
# endstop_pin: tmc2209_stepper_x:virtual_endstop
# homing_retract_dist: 0
position_endstop: -20
position_min: -20
position_max: 230
homing_speed: 50

[tmc2209 stepper_x]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 0
run_current: 0.8
hold_current: 0.6
stealthchop_threshold: 999999
# diag_pin: ^gpio4
# driver_SGTHRS: 100

[stepper_y]
step_pin: gpio6
dir_pin: !gpio5
enable_pin: !gpio7
microsteps: 16
rotation_distance: 40
endstop_pin: ^gpio3
# endstop_pin: tmc2209_stepper_y:virtual_endstop
# homing_retract_dist: 0
position_endstop: -10
position_min: -10
position_max: 220
homing_speed: 50

[tmc2209 stepper_y]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 2
run_current: 0.8
hold_current: 0.6
stealthchop_threshold: 999999
diag_pin: ^gpio3
driver_SGTHRS: 100

[stepper_z]
step_pin: gpio19
dir_pin: !gpio28
enable_pin: !gpio2
microsteps: 16
rotation_distance: 40
gear_ratio: 80:16
# endstop_pin: ^gpio25
# position_endstop: 0
endstop_pin: probe:z_virtual_endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_min: -5.0
position_max: 220
homing_speed: 12

[tmc2209 stepper_z]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 1
run_current: 0.580
hold_current: 0.500
stealthchop_threshold: 999999

[extruder]
#step_pin: gpio14
#dir_pin: !gpio13
#enable_pin: !gpio15
#microsteps: 16
#rotation_distance: 33.500
#nozzle_diameter: 0.4
#filament_diameter: 1.75
#heater_pin: gpio23
#sensor_type: EPCOS 100K B57560G104F
#sensor_pin: gpio27
#control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114
min_temp: 0
max_temp: 300
max_extrude_cross_section:5

[tmc2209 extruder]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 3
run_current: 0.650
hold_current: 0.500
stealthchop_threshold: 999999

[filament_switch_sensor runout_sensor]
switch_pin: ^gpio16
pause_on_runout: True

# [filament_motion_sensor smart_sensor]
# switch_pin: ^gpio16
# detection_length: 2.5

[heater_bed]
heater_pin: gpio21
sensor_type: EPCOS 100K B57560G104F
sensor_pin: gpio26
#control: pid
#pid_Kp: 54.027
#pid_Ki: 0.770
#pid_Kd: 948.182
min_temp: 0
max_temp: 130

#[fan]
#pin: gpio17

#[heater_fan hotend_fan]
#pin: gpio18
#heater: extruder
#heater_temp: 50.0

[temperature_fan controller_fan]
pin: gpio20
cycle_time: 0.010
kick_start_time: 0.100
sensor_type: temperature_host
min_temp: 0
max_temp: 100
control: pid
pid_Kp: 74.421
pid_ki: 1.494
pid_kd: 926.537
#   The proportional (pid_Kp), integral (pid_Ki), and derivative
#   (pid_Kd) settings for the PID feedback control system. Klipper
#   evaluates the PID settings with the following general formula:
#     fan_pwm = max_power - (Kp*e + Ki*integral(e) - Kd*derivative(e)) / 255
#   Where "e" is "target_temperature - measured_temperature" and
#   "fan_pwm" is the requested fan rate with 0.0 being full off and
#   1.0 being full on. The pid_Kp, pid_Ki, and pid_Kd parameters must
#   be provided when the PID control algorithm is enabled.
pid_deriv_time: 2.0
#   A time value (in seconds) over which temperature measurements will
#   be smoothed when using the PID control algorithm. This may reduce
#   the impact of measurement noise. The default is 2 seconds.
target_temp: 50.0
#   A temperature (in Celsius) that will be the target temperature.
#   The default is 40 degrees.
max_speed: 1.0
#   The fan speed (expressed as a value from 0.0 to 1.0) that the fan
#   will be set to when the sensor temperature exceeds the set value.
#   The default is 1.0.
min_speed: 0.3
#   The minimum fan speed (expressed as a value from 0.0 to 1.0) that
#   the fan will be set to for PID temperature fans.
#   The default is 0.3.


[mcu]
# serial: /dev/serial/by-id/usb-Klipper_rp2040_E66094A027854422-if00
serial: /dev/ttyS0
restart_method: command

[mcu EBBCan]
canbus_uuid: a39854ca82d8

[printer]
kinematics: cartesian
max_velocity: 500
max_accel: 3000
max_z_velocity: 25
max_z_accel: 30

[firmware_retraction]
retract_length: 0.4
#   The length of filament (in mm) to retract when G10 is activated,
#   and to unretract when G11 is activated (but see
#   unretract_extra_length below). The default is 0 mm.
retract_speed: 30
#   The speed of retraction, in mm/s. The default is 20 mm/s.
#unretract_extra_length: 0
#   The length (in mm) of *additional* filament to add when
#   unretracting.
unretract_speed: 30
#   The speed of unretraction, in mm/s. The default is 10 mm/s.

[gcode_arcs]
resolution: 1.0
#   An arc will be split into segments. Each segment's length will
#   equal the resolution in mm set above. Lower values will produce a
#   finer arc, but also more work for your machine. Arcs smaller than
#   the configured value will become straight lines. The default is
#   1mm.


[input_shaper]
shaper_freq_x: 36.7
#   A frequency (in Hz) of the input shaper for X axis. This is
#   usually a resonance frequency of X axis that the input shaper
#   should suppress. For more complex shapers, like 2- and 3-hump EI
#   input shapers, this parameter can be set from different
#   considerations. The default value is 0, which disables input
#   shaping for X axis.
shaper_freq_y: 37
#   A frequency (in Hz) of the input shaper for Y axis. This is
#   usually a resonance frequency of Y axis that the input shaper
#   should suppress. For more complex shapers, like 2- and 3-hump EI
#   input shapers, this parameter can be set from different
#   considerations. The default value is 0, which disables input
#   shaping for Y axis.
shaper_type: mzv
#   A type of the input shaper to use for both X and Y axes. Supported
#   shapers are zv, mzv, zvd, ei, 2hump_ei, and 3hump_ei. The default
#   is mzv input shaper.
#shaper_type_x:
#shaper_type_y:
#   If shaper_type is not set, these two parameters can be used to
#   configure different input shapers for X and Y axes. The same
#   values are supported as for shaper_type parameter.
damping_ratio_x: 0.1
damping_ratio_y: 0.1
#   Damping ratios of vibrations of X and Y axes used by input shapers
#   to improve vibration suppression. Default value is 0.1 which is a
#   good all-round value for most printers. In most circumstances this
#   parameter requires no tuning and should not be changed.


#[bltouch]
#sensor_pin: ^gpio22
#control_pin: gpio29
#x_offset: 0
#y_offset: -24.0
#z_offset: 0
#speed: 20
#samples: 1
#sample_retract_dist: 8.0

[neopixel board_rgb]
pin: gpio24
chain_count: 1
color_order: GRB
initial_RED: 0.3
initial_GREEN: 0.3
initial_BLUE: 0.3

[safe_z_home]
home_xy_position: 115,110
speed: 150
z_hop: 10
z_hop_speed: 10


[bed_screws]
screw1:30,25
screw1_name:1
screw2:200,25
screw2_name:2
screw3:200,195
screw3_name:3
screw4:30,195
screw4_name:4

[screws_tilt_adjust]
screw1: 30, 5
screw1_name: front left screw
screw2: 200, 5
screw2_name: front right screw
screw3: 200, 175
screw3_name: rear right screw
screw4: 30, 175
screw4_name: rear left screw
horizontal_move_z: 10
speed: 200
screw_thread: CW-M4 # Use CW for Clockwise and CCW for Counter Clockwise

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 36.751
#*# pid_ki = 11.667
#*# pid_kd = 28.942
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 74.421
#*# pid_ki = 1.494
#*# pid_kd = 926.537
#*#
#*# [scanner model default]
#*# model_coef = 1.4984569909645933,
#*# 	  1.7128035335490976,
#*# 	  0.7697762085942967,
#*# 	  0.07641542683473289,
#*# 	  -0.03048165515031155,
#*# 	  1.6463808755992877,
#*# 	  0.8499019005092148,
#*# 	  -2.6436005591342386,
#*# 	  -0.541504887747535,
#*# 	  1.6631284972061717
#*# model_domain = 3.116123924226334e-07,3.301491168143151e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 57.837810
#*# model_offset = 0.84500
#*#
#*# [scanner]
#*# scanner_touch_threshold = 3000
#*# scanner_touch_z_offset = 0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.002628, 0.005099, 0.007063, 0.015174, 0.014517, 0.014579, 0.015019, 0.015884, 0.016073, 0.017933, 0.017871, 0.017031, 0.017136, 0.017126, 0.016344, 0.014677, 0.016113, 0.016991, 0.015147, 0.014324, 0.013687, 0.013096, 0.011415, 0.009546
#*# 	  0.010261, 0.013854, 0.017502, 0.020453, 0.020084, 0.018829, 0.019526, 0.019860, 0.020688, 0.021209, 0.020619, 0.019869, 0.019207, 0.017859, 0.016368, 0.016205, 0.016159, 0.015273, 0.015265, 0.015012, 0.014621, 0.012243, 0.011573, 0.009023
#*# 	  0.011119, 0.014464, 0.018704, 0.019182, 0.018491, 0.017144, 0.018722, 0.018295, 0.017536, 0.019876, 0.025684, 0.017778, 0.016958, 0.014002, 0.013468, 0.012370, 0.012704, 0.011873, 0.010638, 0.011945, 0.011985, 0.012747, 0.012224, 0.013242
#*# 	  0.017776, 0.019635, 0.021838, 0.020636, 0.018661, 0.016686, 0.020100, 0.020089, 0.022128, 0.020443, 0.020665, 0.017005, 0.017697, 0.014221, 0.013924, 0.013136, 0.012724, 0.011006, 0.009023, 0.009761, 0.009188, 0.009490, 0.009526, 0.008984
#*# 	  0.026706, 0.033239, 0.029873, 0.034630, 0.022889, 0.021917, 0.022342, 0.023337, 0.025232, 0.026447, 0.025045, 0.023457, 0.022927, 0.016317, 0.019182, 0.013067, 0.020290, 0.012775, 0.013726, 0.010392, 0.011258, 0.010368, 0.015066, 0.015471
#*# 	  0.025964, 0.031067, 0.019581, 0.027719, 0.018374, 0.021682, 0.019000, 0.022014, 0.022837, 0.024187, 0.024379, 0.022979, 0.022412, 0.022055, 0.019033, 0.017893, 0.016317, 0.013907, 0.009627, 0.008331, 0.007133, 0.008864, 0.008106, 0.006556
#*# 	  0.029907, 0.032709, 0.024530, 0.029682, 0.018838, 0.027576, 0.019254, 0.032816, 0.021246, 0.035819, 0.030452, 0.034806, 0.027604, 0.029501, 0.023281, 0.021707, 0.021859, 0.018844, 0.015364, 0.011867, 0.015106, 0.014222, 0.015456, 0.013678
#*# 	  0.031095, 0.032450, 0.031836, 0.026339, 0.022035, 0.020126, 0.024553, 0.026245, 0.028583, 0.031154, 0.029734, 0.027001, 0.025908, 0.024489, 0.022081, 0.021856, 0.021895, 0.019684, 0.016376, 0.015819, 0.013999, 0.015156, 0.015533, 0.016514
#*# 	  0.023870, 0.033106, 0.042029, 0.028468, 0.024076, 0.022870, 0.015879, 0.024298, 0.017243, 0.026333, 0.019137, 0.029281, 0.018658, 0.025928, 0.013282, 0.023532, 0.012821, 0.023150, 0.015505, 0.015085, 0.013899, 0.018795, 0.015891, 0.015151
#*# 	  0.031323, 0.028751, 0.034280, 0.019487, 0.025618, 0.016100, 0.023632, 0.020961, 0.021927, 0.021119, 0.022502, 0.019840, 0.019215, 0.018385, 0.016616, 0.017672, 0.016766, 0.015885, 0.014786, 0.014271, 0.013683, 0.015971, 0.018540, 0.017880
#*# 	  0.028133, 0.017957, 0.031669, 0.011368, 0.021143, 0.007421, 0.019804, 0.007972, 0.017444, 0.014953, 0.019065, 0.012278, 0.011427, 0.011902, 0.011108, 0.012705, 0.011134, 0.016416, 0.013025, 0.015611, 0.016317, 0.019618, 0.022868, 0.023493
#*# 	  0.021183, 0.017955, 0.021874, 0.011713, 0.011418, 0.010253, 0.009701, 0.010745, 0.009370, 0.011375, 0.009625, 0.008318, 0.009591, 0.010165, 0.010220, 0.011663, 0.014260, 0.011489, 0.016776, 0.017346, 0.019815, 0.020840, 0.025999, 0.024644
#*# 	  0.018410, 0.016009, 0.012966, 0.009021, 0.006118, 0.005274, 0.010256, 0.001897, 0.011386, 0.000909, 0.011461, 0.000728, 0.009485, 0.002583, 0.010156, 0.006574, 0.016680, 0.012783, 0.015960, 0.019520, 0.023540, 0.025395, 0.030584, 0.031686
#*# 	  0.010729, 0.011283, 0.001520, 0.006286, -0.003051, -0.001528, -0.000353, 0.001818, 0.001967, 0.005405, 0.004985, 0.005055, 0.006658, 0.008319, 0.009749, 0.012680, 0.016523, 0.018688, 0.016167, 0.024621, 0.027299, 0.033863, 0.033520, 0.034175
#*# 	  -0.006323, 0.001740, -0.013237, -0.002623, -0.016312, -0.000693, -0.014428, -0.000414, -0.006938, 0.004489, -0.001592, 0.003456, 0.001294, 0.007320, 0.008348, 0.012833, 0.015634, 0.017480, 0.021204, 0.024935, 0.028521, 0.033596, 0.039784, 0.038913
#*# 	  -0.009612, -0.010789, -0.013263, -0.011986, -0.016181, -0.014467, -0.013616, -0.008621, -0.004474, -0.000072, 0.002465, 0.003243, 0.006596, 0.010119, 0.012639, 0.015625, 0.020215, 0.024471, 0.025346, 0.028975, 0.033547, 0.036678, 0.039626, 0.038916
#*# 	  -0.009930, -0.016306, -0.005609, -0.018243, -0.014700, -0.020036, -0.012187, -0.010456, -0.002359, 0.001231, 0.004726, 0.010110, 0.009682, 0.016464, 0.017878, 0.023255, 0.023664, 0.028877, 0.032878, 0.036538, 0.037840, 0.042309, 0.047332, 0.046856
#*# 	  -0.013679, -0.015190, -0.009162, -0.014958, -0.009393, -0.015164, -0.005494, -0.006333, 0.000076, 0.002976, 0.008561, 0.010551, 0.015215, 0.019386, 0.021917, 0.025137, 0.028338, 0.033291, 0.037072, 0.038698, 0.041855, 0.042374, 0.045350, 0.042045
#*# 	  -0.011375, -0.009084, -0.004062, -0.010404, -0.001089, -0.009650, -0.000353, -0.002844, 0.007124, 0.002311, 0.013167, 0.011268, 0.020412, 0.020561, 0.024550, 0.025927, 0.029582, 0.030923, 0.036517, 0.036156, 0.038560, 0.041560, 0.044790, 0.040164
#*# 	  -0.010177, -0.004997, -0.001201, 0.001550, 0.001853, -0.000538, 0.002679, 0.005179, 0.006036, 0.008020, 0.013180, 0.014773, 0.018054, 0.021491, 0.024411, 0.027029, 0.029443, 0.032720, 0.034075, 0.035142, 0.035901, 0.036281, 0.035466, 0.033863
#*# 	  -0.005654, 0.007055, 0.009082, 0.016737, 0.011879, 0.014633, 0.008112, 0.004936, 0.008408, 0.006683, 0.017615, 0.011637, 0.022638, 0.018293, 0.023667, 0.020485, 0.030886, 0.029098, 0.031749, 0.028986, 0.035077, 0.031775, 0.033506, 0.028543
#*# 	  -0.001776, 0.006002, 0.012680, 0.016911, 0.013068, 0.015740, 0.012328, 0.013335, 0.008286, 0.010554, 0.012632, 0.012530, 0.015813, 0.016945, 0.018296, 0.019821, 0.022472, 0.024142, 0.024182, 0.025414, 0.025507, 0.024915, 0.022778, 0.017064
#*# 	  0.001208, 0.010754, 0.012855, 0.028751, 0.021118, 0.026769, 0.016316, 0.023492, 0.009656, 0.018139, 0.012194, 0.018003, 0.014790, 0.018856, 0.016179, 0.018215, 0.019235, 0.020159, 0.021219, 0.020822, 0.018569, 0.017458, 0.015495, 0.011089
#*# 	  0.007462, 0.013277, 0.022922, 0.035467, 0.036373, 0.035364, 0.033779, 0.028560, 0.023647, 0.020956, 0.021902, 0.021178, 0.022845, 0.023421, 0.024019, 0.023936, 0.023575, 0.024679, 0.023862, 0.023481, 0.022314, 0.019229, 0.017780, 0.010849
#*# x_count = 24
#*# y_count = 24
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 50.0
#*# max_x = 180.0
#*# min_y = 38.9994
#*# max_y = 171.001
