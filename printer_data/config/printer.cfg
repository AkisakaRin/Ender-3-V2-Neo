[include mainsail.cfg]
[exclude_object]
[include EBB36Can.cfg]
[include KAMP_Settings.cfg]
[include macros.cfg]
[include neopixel.cfg]

[temperature_sensor BTT_CB1]
sensor_type: temperature_host
min_temp: 10
max_temp: 100 

[temperature_sensor SKR_Pico]
sensor_type: temperature_mcu
sensor_mcu: mcu
min_temp: 0
max_temp: 100

[temperature_sensor ebb36]
sensor_type: temperature_mcu
sensor_mcu: EBBCan
min_temp: 0
max_temp: 100

[scanner]
canbus_uuid: 2a0496212cbc
#    adjust to suit your scanner, if using usb change to serial.
#    serial: /dev/serial/by-id/usb-cartographer_cartographer_
x_offset: 0                          
#    adjust for your cartographers offset from nozzle to middle of coil
y_offset: 15                         
#    adjust for your cartographers offset from nozzle to middle of coil
backlash_comp: 0.06531
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
# 
#   Offsets are measured from the centre of your coil, to the tip of your nozzle 
#   on a level axis. It is vital that this is accurate. 
calibration_method: scan
#    leave this as touch unless you want to use scan only for everything. 
sensor: cartographer
#    this must be set as cartographer unless using IDM etc.
sensor_alt: carto
#    alternate name to call commands. CARTO_TOUCH etc
#scanner_touch_z_offset: 0.05         
#    This is the default and will be overwritten and added to the DO NOT SAVE area by using UI to save z offset
mesh_runs: 2
#    Number of passes to make during mesh scan.

[bed_mesh]
zero_reference_position: 115, 110    
#    set this to the middle of your bed
speed: 200
#    movement speed of toolhead during bed mesh
horizontal_move_z: 5
#    height of scanner during bed mesh scan
mesh_min: 35, 6
#    start point of bed mesh [X, Y]
mesh_max: 200, 175
#    end point of bed mesh [X, Y]
probe_count: 30, 30
algorithm: bicubic


[stepper_x]
step_pin: gpio11
dir_pin: !gpio10
enable_pin: !gpio12
microsteps: 16
rotation_distance: 40
endstop_pin: ^gpio4
# endstop_pin: tmc2209_stepper_x:virtual_endstop
# homing_retract_dist: 0
position_endstop: -20
position_min: -20
position_max: 230
homing_speed: 50

[tmc2209 stepper_x]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 0
run_current: 0.8
hold_current: 0.6
stealthchop_threshold: 999999
# diag_pin: ^gpio4
# driver_SGTHRS: 100

[stepper_y]
step_pin: gpio6
dir_pin: !gpio5
enable_pin: !gpio7
microsteps: 16
rotation_distance: 40
endstop_pin: ^gpio3
# endstop_pin: tmc2209_stepper_y:virtual_endstop
# homing_retract_dist: 0
position_endstop: -10
position_min: -10
position_max: 220
homing_speed: 50

[tmc2209 stepper_y]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 2
run_current: 0.8
hold_current: 0.6
stealthchop_threshold: 999999
diag_pin: ^gpio3
driver_SGTHRS: 100

[stepper_z]
step_pin: gpio19
dir_pin: !gpio28
enable_pin: !gpio2
microsteps: 16
rotation_distance: 40
gear_ratio: 80:16
# endstop_pin: ^gpio25
# position_endstop: 0
endstop_pin: probe:z_virtual_endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_min: -5.0
position_max: 220
homing_speed: 12

[tmc2209 stepper_z]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 1
run_current: 0.580
hold_current: 0.500
stealthchop_threshold: 999999

[extruder]
#step_pin: gpio14
#dir_pin: !gpio13
#enable_pin: !gpio15
#microsteps: 16
#rotation_distance: 33.500
#nozzle_diameter: 0.4
#filament_diameter: 1.75
#heater_pin: gpio23
#sensor_type: EPCOS 100K B57560G104F
#sensor_pin: gpio27
#control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114
min_temp: 0
max_temp: 300
max_extrude_cross_section:5

[tmc2209 extruder]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 3
run_current: 0.650
hold_current: 0.500
stealthchop_threshold: 999999

[filament_switch_sensor runout_sensor]
switch_pin: ^gpio16
pause_on_runout: True

# [filament_motion_sensor smart_sensor]
# switch_pin: ^gpio16
# detection_length: 2.5

[heater_bed]
heater_pin: gpio21
sensor_type: EPCOS 100K B57560G104F
sensor_pin: gpio26
#control: pid
#pid_Kp: 54.027
#pid_Ki: 0.770
#pid_Kd: 948.182
min_temp: 0
max_temp: 130

#[fan]
#pin: gpio17

#[heater_fan hotend_fan]
#pin: gpio18
#heater: extruder
#heater_temp: 50.0

[temperature_fan controller_fan]
pin: gpio20
cycle_time: 0.010
kick_start_time: 0.100
sensor_type: temperature_host
min_temp: 0
max_temp: 100
control: pid
pid_Kp: 74.421
pid_ki: 1.494
pid_kd: 926.537
#   The proportional (pid_Kp), integral (pid_Ki), and derivative
#   (pid_Kd) settings for the PID feedback control system. Klipper
#   evaluates the PID settings with the following general formula:
#     fan_pwm = max_power - (Kp*e + Ki*integral(e) - Kd*derivative(e)) / 255
#   Where "e" is "target_temperature - measured_temperature" and
#   "fan_pwm" is the requested fan rate with 0.0 being full off and
#   1.0 being full on. The pid_Kp, pid_Ki, and pid_Kd parameters must
#   be provided when the PID control algorithm is enabled.
pid_deriv_time: 2.0
#   A time value (in seconds) over which temperature measurements will
#   be smoothed when using the PID control algorithm. This may reduce
#   the impact of measurement noise. The default is 2 seconds.
target_temp: 50.0
#   A temperature (in Celsius) that will be the target temperature.
#   The default is 40 degrees.
max_speed: 1.0
#   The fan speed (expressed as a value from 0.0 to 1.0) that the fan
#   will be set to when the sensor temperature exceeds the set value.
#   The default is 1.0.
min_speed: 0.3
#   The minimum fan speed (expressed as a value from 0.0 to 1.0) that
#   the fan will be set to for PID temperature fans.
#   The default is 0.3.


[mcu]
# serial: /dev/serial/by-id/usb-Klipper_rp2040_E66094A027854422-if00
serial: /dev/ttyS0
restart_method: command

[mcu EBBCan]
canbus_uuid: a39854ca82d8

[printer]
kinematics: cartesian
max_velocity: 500
max_accel: 3000
max_z_velocity: 25
max_z_accel: 30

[firmware_retraction]
retract_length: 0.4
#   The length of filament (in mm) to retract when G10 is activated,
#   and to unretract when G11 is activated (but see
#   unretract_extra_length below). The default is 0 mm.
retract_speed: 30
#   The speed of retraction, in mm/s. The default is 20 mm/s.
#unretract_extra_length: 0
#   The length (in mm) of *additional* filament to add when
#   unretracting.
unretract_speed: 30
#   The speed of unretraction, in mm/s. The default is 10 mm/s.

[gcode_arcs]
resolution: 1.0
#   An arc will be split into segments. Each segment's length will
#   equal the resolution in mm set above. Lower values will produce a
#   finer arc, but also more work for your machine. Arcs smaller than
#   the configured value will become straight lines. The default is
#   1mm.


[input_shaper]
shaper_freq_x: 36.7
#   A frequency (in Hz) of the input shaper for X axis. This is
#   usually a resonance frequency of X axis that the input shaper
#   should suppress. For more complex shapers, like 2- and 3-hump EI
#   input shapers, this parameter can be set from different
#   considerations. The default value is 0, which disables input
#   shaping for X axis.
shaper_freq_y: 37
#   A frequency (in Hz) of the input shaper for Y axis. This is
#   usually a resonance frequency of Y axis that the input shaper
#   should suppress. For more complex shapers, like 2- and 3-hump EI
#   input shapers, this parameter can be set from different
#   considerations. The default value is 0, which disables input
#   shaping for Y axis.
shaper_type: mzv
#   A type of the input shaper to use for both X and Y axes. Supported
#   shapers are zv, mzv, zvd, ei, 2hump_ei, and 3hump_ei. The default
#   is mzv input shaper.
#shaper_type_x:
#shaper_type_y:
#   If shaper_type is not set, these two parameters can be used to
#   configure different input shapers for X and Y axes. The same
#   values are supported as for shaper_type parameter.
damping_ratio_x: 0.1
damping_ratio_y: 0.1
#   Damping ratios of vibrations of X and Y axes used by input shapers
#   to improve vibration suppression. Default value is 0.1 which is a
#   good all-round value for most printers. In most circumstances this
#   parameter requires no tuning and should not be changed.


#[bltouch]
#sensor_pin: ^gpio22
#control_pin: gpio29
#x_offset: 0
#y_offset: -24.0
#z_offset: 0
#speed: 20
#samples: 1
#sample_retract_dist: 8.0

[neopixel board_rgb]
pin: gpio24
chain_count: 1
color_order: GRB
initial_RED: 0.3
initial_GREEN: 0.3
initial_BLUE: 0.3

[safe_z_home]
home_xy_position: 115,110
speed: 150
z_hop: 10
z_hop_speed: 10


[bed_screws]
screw1:30,25
screw1_name:1
screw2:200,25
screw2_name:2
screw3:200,195
screw3_name:3
screw4:30,195
screw4_name:4

[screws_tilt_adjust]
screw1: 30, 5
screw1_name: front left screw
screw2: 200, 5
screw2_name: front right screw
screw3: 200, 175
screw3_name: rear right screw
screw4: 30, 175
screw4_name: rear left screw
horizontal_move_z: 10
speed: 200
screw_thread: CW-M4 # Use CW for Clockwise and CCW for Counter Clockwise

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 36.751
#*# pid_ki = 11.667
#*# pid_kd = 28.942
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 74.421
#*# pid_ki = 1.494
#*# pid_kd = 926.537
#*#
#*# [scanner model default]
#*# model_coef = 1.4984569909645933,
#*# 	  1.7128035335490976,
#*# 	  0.7697762085942967,
#*# 	  0.07641542683473289,
#*# 	  -0.03048165515031155,
#*# 	  1.6463808755992877,
#*# 	  0.8499019005092148,
#*# 	  -2.6436005591342386,
#*# 	  -0.541504887747535,
#*# 	  1.6631284972061717
#*# model_domain = 3.116123924226334e-07,3.301491168143151e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 57.837810
#*# model_offset = 0.83500
#*#
#*# [scanner]
#*# scanner_touch_threshold = 3000
#*# scanner_touch_z_offset = 0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.011265, 0.016721, 0.023039, 0.021239, 0.028099, 0.022567, 0.029335, 0.023960, 0.029358, 0.025495, 0.030813, 0.024923, 0.030836, 0.019879, 0.024075, 0.017800, 0.024277, 0.022502, 0.025553, 0.022014, 0.022555, 0.020559, 0.017990, 0.016605
#*# 	  0.023601, 0.024675, 0.027638, 0.029659, 0.028940, 0.026539, 0.027925, 0.026057, 0.024562, 0.027457, 0.029342, 0.025342, 0.027764, 0.023825, 0.026384, 0.017781, 0.026092, 0.018018, 0.023043, 0.019485, 0.021294, 0.015243, 0.017244, 0.017800
#*# 	  0.026625, 0.039239, 0.028713, 0.037314, 0.019635, 0.037300, 0.019586, 0.035627, 0.021296, 0.028884, 0.021379, 0.026857, 0.019107, 0.022809, 0.021217, 0.019573, 0.020836, 0.019270, 0.020558, 0.020111, 0.021311, 0.021455, 0.019691, 0.022773
#*# 	  0.029993, 0.030541, 0.029285, 0.029525, 0.026410, 0.022937, 0.025006, 0.027070, 0.025655, 0.029893, 0.026586, 0.028757, 0.024343, 0.024516, 0.016750, 0.021897, 0.015787, 0.020616, 0.012905, 0.018672, 0.013535, 0.019775, 0.010642, 0.014165
#*# 	  0.036182, 0.028502, 0.039824, 0.025428, 0.037581, 0.020862, 0.028662, 0.022596, 0.028853, 0.022994, 0.031579, 0.030436, 0.027559, 0.026852, 0.025751, 0.023019, 0.022460, 0.019629, 0.017672, 0.016186, 0.018097, 0.018995, 0.021026, 0.023195
#*# 	  0.038162, 0.036719, 0.034875, 0.032450, 0.026371, 0.026059, 0.027598, 0.027438, 0.028827, 0.031646, 0.030997, 0.025736, 0.031337, 0.024120, 0.029141, 0.019349, 0.027279, 0.015992, 0.020228, 0.009566, 0.020109, 0.007356, 0.021274, 0.011081
#*# 	  0.036813, 0.047086, 0.025986, 0.034805, 0.019377, 0.027957, 0.030316, 0.030136, 0.032358, 0.035289, 0.033317, 0.031367, 0.032136, 0.030011, 0.026236, 0.024439, 0.032867, 0.022230, 0.019953, 0.018634, 0.019210, 0.012983, 0.020300, 0.019252
#*# 	  0.044999, 0.042961, 0.037298, 0.036717, 0.033725, 0.029943, 0.030848, 0.031694, 0.034062, 0.034900, 0.034061, 0.032785, 0.029751, 0.028582, 0.026780, 0.026728, 0.025792, 0.023772, 0.020128, 0.020501, 0.018372, 0.019492, 0.017208, 0.019554
#*# 	  0.045255, 0.035279, 0.038137, 0.037136, 0.033973, 0.029691, 0.030183, 0.030960, 0.032218, 0.032065, 0.030817, 0.030272, 0.026683, 0.028291, 0.022684, 0.027095, 0.022372, 0.019300, 0.019366, 0.020873, 0.019970, 0.016772, 0.020323, 0.023520
#*# 	  0.046484, 0.042083, 0.038143, 0.035120, 0.029614, 0.027358, 0.027180, 0.027700, 0.028269, 0.028590, 0.026874, 0.024492, 0.023786, 0.023317, 0.020505, 0.015350, 0.022565, 0.019218, 0.017712, 0.022244, 0.023766, 0.018625, 0.018144, 0.021384
#*# 	  0.034835, 0.032461, 0.028456, 0.028476, 0.025501, 0.020311, 0.022493, 0.020927, 0.019127, 0.020432, 0.018402, 0.016113, 0.015304, 0.016146, 0.014424, 0.013565, 0.017260, 0.018254, 0.015672, 0.017403, 0.022554, 0.022105, 0.024222, 0.028543
#*# 	  0.036875, 0.030793, 0.027402, 0.025019, 0.019481, 0.014325, 0.017368, 0.017143, 0.015360, 0.015129, 0.014473, 0.014659, 0.013412, 0.014431, 0.014292, 0.014324, 0.016485, 0.016234, 0.015982, 0.020268, 0.025663, 0.026297, 0.027119, 0.029309
#*# 	  0.024520, 0.021928, 0.016425, 0.016664, 0.012631, 0.001290, 0.009580, 0.008411, 0.009157, 0.008128, 0.011606, 0.008313, 0.008773, 0.011043, 0.010118, 0.012378, 0.016716, 0.017322, 0.017184, 0.024547, 0.030926, 0.033094, 0.031345, 0.035831
#*# 	  0.018158, 0.013135, 0.009098, 0.007365, 0.003116, 0.001142, 0.004854, 0.005029, 0.005633, 0.007159, 0.007161, 0.006044, 0.007028, 0.009352, 0.008632, 0.012311, 0.017856, 0.018339, 0.019514, 0.025099, 0.030955, 0.031394, 0.032483, 0.035850
#*# 	  0.011948, 0.007424, -0.001770, 0.001648, -0.008262, -0.006595, -0.001125, 0.006706, 0.001886, 0.008542, 0.006240, 0.006702, 0.005116, 0.010710, 0.011419, 0.012274, 0.017786, 0.020482, 0.020700, 0.025450, 0.034447, 0.037201, 0.034871, 0.039462
#*# 	  0.007368, 0.003796, -0.002907, -0.003106, -0.008249, -0.010313, -0.004650, -0.001525, 0.000767, 0.005250, 0.007966, 0.008803, 0.008515, 0.013567, 0.014236, 0.018077, 0.023812, 0.024969, 0.026010, 0.030625, 0.036098, 0.038079, 0.037829, 0.039332
#*# 	  -0.001418, -0.006559, -0.007989, -0.013026, -0.001717, -0.009608, 0.000468, -0.003353, 0.004537, 0.005552, 0.007177, 0.011534, 0.013202, 0.017845, 0.018491, 0.021386, 0.026555, 0.029475, 0.030845, 0.036210, 0.041961, 0.043816, 0.037638, 0.044580
#*# 	  0.000082, 0.000052, -0.003071, -0.002709, -0.005869, -0.006682, -0.001281, 0.001681, 0.005534, 0.009990, 0.013155, 0.016963, 0.021356, 0.020980, 0.024599, 0.026005, 0.034715, 0.034324, 0.036786, 0.041750, 0.046455, 0.044736, 0.043506, 0.048190
#*# 	  -0.000432, 0.002439, -0.003045, 0.008685, 0.001446, 0.001546, 0.002987, 0.008568, 0.007769, 0.015017, 0.016604, 0.019070, 0.020928, 0.023143, 0.026968, 0.028356, 0.033307, 0.036684, 0.036779, 0.040861, 0.043468, 0.043057, 0.042459, 0.043277
#*# 	  0.003880, 0.005595, 0.006445, 0.011567, 0.010134, 0.006781, 0.008739, 0.009760, 0.009759, 0.013530, 0.017297, 0.020451, 0.021260, 0.024264, 0.025627, 0.027041, 0.029968, 0.033352, 0.034943, 0.039070, 0.040276, 0.037767, 0.033043, 0.033074
#*# 	  0.008754, 0.011489, 0.015332, 0.018561, 0.022629, 0.016160, 0.016468, 0.014412, 0.015515, 0.016775, 0.018831, 0.021746, 0.023987, 0.025282, 0.026207, 0.028839, 0.030972, 0.030480, 0.032484, 0.036704, 0.038661, 0.038711, 0.032938, 0.032100
#*# 	  0.011460, 0.019868, 0.023559, 0.029174, 0.029344, 0.026635, 0.025661, 0.021230, 0.020377, 0.017811, 0.018668, 0.021372, 0.022782, 0.024901, 0.025289, 0.024879, 0.025458, 0.027298, 0.030596, 0.032681, 0.031777, 0.029040, 0.026017, 0.021091
#*# 	  0.015952, 0.028151, 0.031478, 0.037840, 0.041986, 0.038118, 0.034642, 0.029458, 0.026210, 0.024585, 0.026286, 0.029000, 0.028580, 0.029513, 0.029597, 0.028816, 0.027915, 0.029199, 0.031640, 0.031602, 0.028942, 0.027964, 0.023585, 0.019639
#*# 	  0.023223, 0.033268, 0.042625, 0.044540, 0.046708, 0.047143, 0.043329, 0.038051, 0.033009, 0.030086, 0.028899, 0.028157, 0.028903, 0.030640, 0.029335, 0.027650, 0.028499, 0.027245, 0.026348, 0.026044, 0.022411, 0.020982, 0.015930, 0.010557
#*# x_count = 24
#*# y_count = 24
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 50.0
#*# max_x = 180.0
#*# min_y = 38.9994
#*# max_y = 171.001
